<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Studyflix — Questões</title>
<link rel="shortcut icon" href="https://i.ibb.co/Z1BfkM6Y/Logo-1.png" type="image/png">
<style>
  /* ===== Visual inspirado no seu index (Netflix-style Studyflix) ===== */
  :root{
    --bg:#000;
    --panel:#0b0b14;
    --card:#181818;
    --accent:#9b59b6;
    --accent-2:#a855f7;
    --muted:#cfc7f7;
    --white:#ffffff;
    --success:#16a34a;
    --danger:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:'Helvetica Neue',Arial,system-ui;background:linear-gradient(180deg,#07070f 0%,#0a0a18 70%);color:var(--white);min-height:100vh}
  header{background:#141414;height:70px;display:flex;align-items:center;justify-content:space-between;padding:0 40px;position:fixed;top:0;width:100%;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,0.7)}
  .logo{height:45px;cursor:pointer}
  nav{display:flex;gap:22px;align-items:center}
  .nav-link{color:#fff;font-weight:700;font-size:1.05rem;cursor:pointer;text-transform:uppercase;letter-spacing:1.5px;padding:8px 0;border-bottom:3px solid transparent}
  .nav-link:hover,.nav-link.active{color:var(--accent-2);border-bottom:3px solid var(--accent-2)}
  main{margin-top:90px;max-width:1200px;margin-left:auto;margin-right:auto;padding:20px}
  .intro{margin-bottom:18px}
  .section-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:28px}
  @media(max-width:1000px){.section-grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:640px){.section-grid{grid-template-columns:1fr}}
  .big-card{background:var(--card);border-radius:8px;padding:12px;cursor:pointer;display:flex;flex-direction:column;align-items:center;transition:transform .18s,box-shadow .18s;border:1px solid rgba(255,255,255,0.03)}
  .big-card:hover{transform:translateY(-6px);box-shadow:0 12px 36px rgba(155,89,182,0.12)}
  .big-card img{width:100%;height:140px;object-fit:cover;border-bottom:4px solid var(--accent)}
  .big-title{padding:12px;font-weight:800;font-size:1.05rem;color:var(--white);text-shadow:0 0 6px rgba(155,89,182,0.85)}
  /* Área de perguntas (oculta por padrão) */
  .questions-area{display:none;margin-top:12px}
  .panel{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 12px 36px rgba(0,0,0,0.55)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
  .filter{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:#fff;cursor:pointer}
  .filter select{background:transparent;border:none;color:#fff;outline:none}
  .search{flex:1;display:flex;gap:8px}
  .search input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:#06060a;color:#fff}
  .cards-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .q-card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:8px}
  .q-top{display:flex;justify-content:space-between;align-items:center}
  .q-title{font-weight:700;font-size:14px;color:#fff}
  .q-meta{font-size:12px;color:var(--muted)}
  .include-toggle{display:flex;gap:8px;align-items:center}
  .btn {background:var(--accent-2);border:none;color:#fff;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  .quiz{margin-top:14px;background:var(--panel);padding:16px;border-radius:12px}
  .quiz .head{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
  .quiz .head h2{margin:0;color:var(--accent-2)}
  .progress{font-size:13px;color:var(--muted)}
  .question-box{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  .q-text{font-weight:700;font-size:1.05rem;margin-bottom:12px;color:var(--white)}
  .answers{display:flex;flex-direction:column;gap:10px}
  .answer-btn{background:#0a0a16;border:1px solid rgba(255,255,255,0.04);padding:12px;border-radius:10px;cursor:pointer;text-align:left;display:flex;gap:12px;align-items:center;transition:all .16s;color:#fff}
  .answer-btn:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(168,85,247,0.06)}
  .answer-btn.disabled{opacity:0.7;cursor:not-allowed;transform:none}
  .answer-btn.correct{background:rgba(22,163,74,0.18);border-color:rgba(22,163,74,0.5);color:var(--white)}
  .answer-btn.wrong{background:rgba(239,68,68,0.12);border-color:rgba(239,68,68,0.4);color:var(--white)}
  .ctrls{display:flex;gap:8px;align-items:center;margin-top:12px}
  .summary{margin-top:12px;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
  .ranking-placeholder{text-align:center;color:#cfc7f7;font-style:italic;padding:26px 10px}
  .footer{max-width:1200px;margin:20px auto 60px auto;color:#aaa;font-size:13px;text-align:center}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:2000}
  .modal-box{background:var(--panel);padding:16px;border-radius:12px;max-width:920px;width:95%}
  .small{font-size:12px;color:var(--muted)}
  /* responsive */
  @media(max-width:880px){
    .cards-grid{grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  }
  @media(max-width:640px){
    header{padding:0 16px}
    .logo{height:40px}
    .controls{flex-direction:column;align-items:stretch}
    .quiz .head{flex-direction:column;align-items:flex-start;gap:6px}
    .cards-grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<header>
  <img class="logo" src="https://i.ibb.co/Z1BfkM6Y/Logo-1.png" alt="Studyflix Logo">
  <nav>
    <div class="nav-link" onclick="location.href='index.html'">Início</div>
    <div class="nav-link active">Questões</div>
    <div class="nav-link" onclick="location.href='index.html#section'">Aulas</div>
  </nav>
</header>

<main>
  <!-- INTRO + 4 BLOQUIOS COMO NO INDEX -->
  <section class="intro">
    <h1 id="pageTitle" style="margin:0;color:var(--white);font-size:28px;font-weight:900;letter-spacing:1px">Banco de Questões — Studyflix</h1>
    <p class="small" style="margin-top:8px;color:var(--muted)">Clique em uma área para abrir o filtro de questões — mantenho o estilo do site.</p>
  </section>

  <!-- 4 blocos principais: Natureza / Humanas / Matemática / Linguagens -->
  <section class="section-grid" id="homeGrid">
    <!-- CIÊNCIAS DA NATUREZA -->
    <div class="big-card" data-area="natureza" onclick="openArea('Ciências da Natureza')">
      <img src="https://i.ibb.co/1YJBLpsW/Whats-App-Image-2025-02-27-at-19-58-54.jpg" alt="">
      <div class="big-title">CIÊNCIAS DA NATUREZA<br><small class="small">Biologia • Física • Química</small></div>
    </div>

    <!-- CIÊNCIAS HUMANAS -->
    <div class="big-card" data-area="humanas" onclick="openArea('Ciências Humanas')">
      <img src="https://i.ibb.co/vxkpd9PD/Whats-App-Image-2025-02-28-at-14-57-59.jpg" alt="">
      <div class="big-title">CIÊNCIAS HUMANAS<br><small class="small">História • Geografia • Sociologia • Filosofia</small></div>
    </div>

    <!-- MATEMÁTICA -->
    <div class="big-card" data-area="matematica" onclick="openArea('Matemática')">
      <img src="https://i.ibb.co/DHVtkXbR/Whats-App-Image-2025-02-28-at-21-48-52.jpg" alt="">
      <div class="big-title">MATEMÁTICA<br><small class="small">Básica • Álgebra • Estatística • Geometria</small></div>
    </div>

    <!-- LINGUAGENS -->
    <div class="big-card" data-area="linguagens" onclick="openArea('Linguagens')">
      <img src="https://i.ibb.co/Y4b7kjRw/Whats-App-Image-2025-03-03-at-16-46-53.jpg" alt="">
      <div class="big-title">LINGUAGENS<br><small class="small">Literatura • Gramática • Artes • Língua Estrangeira</small></div>
    </div>
  </section>

  <!-- QUESTIONS AREA (inicialmente hidden) -->
  <section class="questions-area panel" id="questionsArea">
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px">
      <button class="btn ghost" onclick="backHome()">← Voltar</button>
      <div style="font-weight:800;font-size:18px;color:var(--accent-2)" id="areaTitle">Área</div>
      <div style="margin-left:auto;color:var(--muted)" id="areaSubtitle">Filtre por matéria / conteúdo / prova</div>
    </div>

    <!-- CONTROLS: filtros -->
    <div class="controls">
      <div class="filter">
        <label class="small">Matéria</label>
        <select id="filterSubject">
          <!-- preenchido dinamicamente -->
        </select>
      </div>

      <div class="filter">
        <label class="small">Conteúdo</label>
        <select id="filterContent">
          <option value="all">Todos os conteúdos</option>
        </select>
      </div>

      <div class="filter">
        <label class="small">Tipo de prova</label>
        <select id="filterExam">
          <option value="all">Todos (ENEM / PAS)</option>
          <option value="ENEM">ENEM</option>
          <option value="PAS I">PAS I</option>
          <option value="PAS II">PAS II</option>
          <option value="PAS III">PAS III</option>
        </select>
      </div>

      <div class="search" style="margin-left:8px">
        <input id="searchInput" placeholder="Buscar por palavra/frase, enunciado ou alternativa...">
        <button class="btn ghost" id="btnClearSearch">Limpar</button>
      </div>

      <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
        <div class="small" id="countSelected">0 selecionadas</div>
        <button class="btn ghost" id="btnSelectVisible">Selecionar visíveis</button>
        <button class="btn ghost" id="btnSelectAll">Selecionar todas</button>
        <button class="btn" id="btnStartQuiz">Iniciar Quiz</button>
      </div>
    </div>

    <!-- QUIZ TOP (sempre visível) -->
    <div class="quiz" id="quizPanel">
      <div class="head">
        <h2 id="quizTitle">Modo Quiz</h2>
        <div class="progress" id="progressInfo">Questão 0 / 0</div>
      </div>

      <div class="question-box">
        <div id="questionArea">
          <div class="q-text" id="qText">Selecione questões no catálogo e clique em "Iniciar Quiz".</div>
          <div class="answers" id="answers"></div>
        </div>

        <div class="ctrls">
          <button class="btn ghost" id="btnSkip">Pular</button>
          <button class="btn ghost" id="btnPrev">Anterior</button>
          <button class="btn ghost" id="btnNext" disabled>Próxima</button>
          <div style="flex:1"></div>
          <button class="btn ghost" id="btnExport">Exportar questões (JSON)</button>
          <button class="btn ghost" id="btnImport">Importar (colar JSON)</button>
        </div>

        <div class="summary" id="summaryArea" style="display:none"></div>
      </div>
    </div>

    <!-- GRID de cards de questões -->
    <div style="height:14px"></div>
    <div class="cards-grid" id="cardsGrid"></div>

    <!-- RANKING -->
    <div style="margin-top:12px" class="panel">
      <h3>Ranking Global</h3>
      <div class="ranking-placeholder">Sem informações — em manutenção</div>
    </div>
  </section>

  <div class="footer">© 2025 Studyflix — Estilo: ENEM / PAS (questões originais para treino)</div>
</main>

<!-- Modal container -->
<div id="modalRoot"></div>

<script>
/* ============================
  Dados: matérias e conteúdos (matriz simplificada)
  - Estrutura: areas -> subjects -> contents[]
  - Cada content terá ao menos 2 questões exemplares (originais)
  - Você pode importar JSON com mais questões (botão Import)
============================ */

const AREAS = {
  "Ciências da Natureza": {
    subjects: {
      "Biologia": ["Citologia","Genética","Ecologia","Fisiologia","Evolução"],
      "Física": ["Mecânica","Óptica","Eletricidade","Termodinâmica","Ondulatória"],
      "Química": ["Estequiometria","Química Orgânica","pH e soluções","Ligação Química","Reações"]
    }
  },
  "Ciências Humanas": {
    subjects: {
      "História Geral":["Brasil Colônia","Modernidade","Guerras Mundiais","Movimentos Sociais","República"],
      "Geografia":["Cartografia","Climas","Urbanização","Relevo","Economia"],
      "Sociologia":["Estratificação","Cultura","Instituições","Movimentos Sociais","Globalização"],
      "Filosofia":["Ética","Política","Epistemologia","Estética","Metafísica"]
    }
  },
  "Matemática": {
    subjects: {
      "Matemática Básica":["Aritmética","Proporções","Porcentagem","Raciocínio Lógico","Medidas"],
      "Álgebra":["Equações","Funções","Polinômios","Sistemas","Progressões"],
      "Estatística e Probabilidade":["Gráficos","Probabilidade","Média/Mediana","Desvio Padrão","Análise de Dados"],
      "Geometria":["Área/Perímetro","Triângulos","Circunferência","Geometria Analítica","Sólidos"]
    }
  },
  "Linguagens": {
    subjects: {
      "Literatura":["Gêneros","Movimentos","Interpretação","Figuras de Linguagem","Autoria"],
      "Artes":["Períodos Artísticos","Iconografia","Elementos Visuais","Música","Design"],
      "Gramática":["Sintaxe","Morfologia","Ortografia","Pontuação","Concordância"],
      "Língua Estrangeira":["Compreensão","Vocabulário","Gramática Básica","Tradução","Expressões"]
    }
  }
};

/* ======== QUESTÕES EXEMPLARES (pelo menos 2 por conteúdo) ========
Formato: { id, area, subject, content, exam, styleLabel, q, choices:[], correct }
Obs: todas originais e curtas. Você pode importar um JSON com mais questões. 
====== */
let QUESTIONS = [];

// helper to push question
function addQ(o){
  o.id = QUESTIONS.length ? QUESTIONS[QUESTIONS.length-1].id + 1 : 1001;
  QUESTIONS.push(o);
}

/* --- gerar 2 perguntas por conteúdo (exemplos originais) --- */
(function seedQuestions(){
  // iterate areas
  Object.keys(AREAS).forEach(areaName=>{
    const subjects = AREAS[areaName].subjects;
    Object.keys(subjects).forEach(subject=>{
      subjects[subject].forEach(content=>{
        // create two sample questions per content
        addQ({
          area: areaName, subject, content,
          exam: Math.random()>0.5? "ENEM" : "PAS I",
          styleLabel: "Estilo: " + (Math.random()>0.5? "ENEM 20XX" : "PAS X/20XX"),
          q: `(${subject} • ${content}) Questão exemplo 1: Leia o enunciado e escolha a alternativa correta (pergunta gerada automaticamente).`,
          choices: ["Alternativa A","Alternativa B","Alternativa C","Alternativa D","Alternativa E"],
          correct: Math.floor(Math.random()*5)
        });
        addQ({
          area: areaName, subject, content,
          exam: Math.random()>0.5? "ENEM" : "PAS II",
          styleLabel: "Estilo: " + (Math.random()>0.5? "ENEM 20XX" : "PAS Y/20XX"),
          q: `(${subject} • ${content}) Questão exemplo 2: Interprete o trecho e marque a alternativa correta.`,
          choices: ["A","B","C","D","E"],
          correct: Math.floor(Math.random()*5)
        });
      });
    });
  });
})();

/* ========== STATE ========== */
let currentArea = null;
let visibleQuestions = QUESTIONS.slice();
let selectedIds = new Set();
let quizList = [];
let quizIndex = 0;
let answeredIds = new Set();
let attemptsKey = 'sf_attempts_v2';

/* ========== UI refs ========== */
const homeGrid = document.getElementById('homeGrid');
const questionsArea = document.getElementById('questionsArea');
const areaTitle = document.getElementById('areaTitle');
const areaSubtitle = document.getElementById('areaSubtitle');
const filterSubject = document.getElementById('filterSubject');
const filterContent = document.getElementById('filterContent');
const filterExam = document.getElementById('filterExam');
const searchInput = document.getElementById('searchInput');
const cardsGrid = document.getElementById('cardsGrid');
const countSelected = document.getElementById('countSelected');
const btnSelectVisible = document.getElementById('btnSelectVisible');
const btnSelectAll = document.getElementById('btnSelectAll');
const btnStartQuiz = document.getElementById('btnStartQuiz');
const progressInfo = document.getElementById('progressInfo');
const qText = document.getElementById('qText');
const answersEl = document.getElementById('answers');
const btnSkip = document.getElementById('btnSkip');
const btnPrev = document.getElementById('btnPrev');
const btnNext = document.getElementById('btnNext');
const summaryArea = document.getElementById('summaryArea');
const modalRoot = document.getElementById('modalRoot');
const btnExport = document.getElementById('btnExport');
const btnImport = document.getElementById('btnImport');
const btnClearSearch = document.getElementById('btnClearSearch');

/* ========== Init UI ========== */
function openArea(areaName){
  currentArea = areaName;
  document.getElementById('areaTitle').textContent = areaName;
  document.getElementById('areaSubtitle').textContent = 'Filtrar por matéria, conteúdo e prova';
  // populate subject select based on area
  const subjects = AREAS[areaName].subjects;
  filterSubject.innerHTML = '<option value="all">Todas as matérias</option>';
  Object.keys(subjects).forEach(s => {
    const o = document.createElement('option'); o.value = s; o.textContent = s; filterSubject.appendChild(o);
  });
  // reset content
  filterContent.innerHTML = '<option value="all">Todos os conteúdos</option>';
  filterExam.value = 'all';
  searchInput.value = '';
  selectedIds.clear();
  updateSelectedCount();
  applyFilters();
  // show questions area, hide home grid
  document.getElementById('homeGrid').style.display = 'none';
  questionsArea.style.display = 'block';
  window.scrollTo({top:0,behavior:'smooth'});
}

function backHome(){
  questionsArea.style.display = 'none';
  document.getElementById('homeGrid').style.display = 'grid';
  currentArea = null;
}

/* ========== Filters & render ========== */
function applyFilters(){
  const subj = filterSubject.value;
  const content = filterContent.value;
  const exam = filterExam.value;
  const term = (searchInput.value||'').trim().toLowerCase();

  // update content list when subject changes
  if(subj !== 'all'){
    const contents = AREAS[currentArea].subjects[subj];
    filterContent.innerHTML = '<option value="all">Todos os conteúdos</option>';
    contents.forEach(c => {
      const o = document.createElement('option'); o.value = c; o.textContent = c; filterContent.appendChild(o);
    });
  } else {
    // if "all subjects" selected, list union of all contents in area
    const all = new Set();
    Object.values(AREAS[currentArea].subjects).forEach(arr=>arr.forEach(x=>all.add(x)));
    filterContent.innerHTML = '<option value="all">Todos os conteúdos</option>';
    Array.from(all).forEach(c => { const o=document.createElement('option'); o.value=c; o.textContent=c; filterContent.appendChild(o);});
    if(content !== 'all') filterContent.value = content; // preserve selection if possible
  }

  visibleQuestions = QUESTIONS.filter(q=>{
    if(q.area !== currentArea) return false;
    if(subj !== 'all' && q.subject !== subj) return false;
    if(content !== 'all' && q.content !== content) return false;
    if(exam !== 'all' && q.exam !== exam) return false;
    if(term){
      const hay = (q.q + ' ' + q.choices.join(' ') + ' ' + q.styleLabel).toLowerCase();
      if(!hay.includes(term)) return false;
    }
    return true;
  });

  renderCards();
}

function renderCards(){
  cardsGrid.innerHTML = '';
  visibleQuestions.forEach(q=>{
    const el = document.createElement('div');
    el.className = 'q-card';
    el.dataset.id = q.id;
    el.innerHTML = `
      <div class="q-top">
        <div>
          <div class="q-title">${escapeHtml(q.q)}</div>
          <div class="q-meta">${escapeHtml(q.subject)} • ${escapeHtml(q.content)} • <small class="small">${escapeHtml(q.exam)} • ${escapeHtml(q.styleLabel)}</small></div>
        </div>
        <div class="include-toggle">
          <label class="small">Incluir</label>
          <input type="checkbox" data-id="${q.id}" class="include-chk" ${selectedIds.has(q.id)?'checked':''}/>
        </div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div class="small">${q.choices.length} alternativas</div>
        <div class="card-actions">
          <button class="btn ghost view-btn" data-id="${q.id}">Visualizar</button>
        </div>
      </div>
    `;
    cardsGrid.appendChild(el);
  });

  // bind includes
  Array.from(document.querySelectorAll('.include-chk')).forEach(chk=>{
    chk.addEventListener('change', e=>{
      const id = Number(e.target.dataset.id);
      if(e.target.checked) selectedIds.add(id); else selectedIds.delete(id);
      updateSelectedCount();
    });
  });
  // bind view
  Array.from(document.querySelectorAll('.view-btn')).forEach(b=>{
    b.addEventListener('click', e=>{
      const id = Number(e.target.dataset.id);
      const q = QUESTIONS.find(x=>x.id===id);
      if(q) showPreview(q);
    });
  });
}

/* ========== selection helpers ========== */
function updateSelectedCount(){
  countSelected.textContent = `${selectedIds.size} selecionadas`;
}
btnSelectVisible.addEventListener('click', ()=>{
  visibleQuestions.forEach(q=>selectedIds.add(q.id));
  renderCards(); updateSelectedCount();
});
btnSelectAll.addEventListener('click', ()=>{
  QUESTIONS.filter(q=>q.area===currentArea).forEach(q=>selectedIds.add(q.id));
  renderCards(); updateSelectedCount();
});

/* ========== Quiz logic ========== */
btnStartQuiz.addEventListener('click', ()=>{
  // build quiz list: if any selected use them, else use visibleQuestions
  const pool = selectedIds.size ? QUESTIONS.filter(q=>selectedIds.has(q.id)) : visibleQuestions.slice();
  if(pool.length===0){ alert('Nenhuma questão selecionada/visível. Ajuste filtros.'); return; }
  quizList = pool.slice();
  shuffleArray(quizList);
  quizIndex = 0;
  answeredIds = new Set(JSON.parse(localStorage.getItem(attemptsKey) || '[]').map(a=>a.qid));
  loadQuizQuestion();
});

function loadQuizQuestion(){
  if(!quizList || quizList.length===0){ qText.textContent='Nenhuma questão no quiz.'; answersEl.innerHTML=''; progressInfo.textContent='Questão 0 / 0'; return; }
  if(quizIndex >= quizList.length){ showSummary(); return; }
  const q = quizList[quizIndex];
  progressInfo.textContent = `Questão ${quizIndex+1} / ${quizList.length}`;
  qText.textContent = q.q;
  answersEl.innerHTML = '';
  btnPrev.disabled = quizIndex===0;
  btnNext.disabled = true;
  summaryArea.style.display='none';
  // build answers
  q.choices.forEach((c, idx)=>{
    const b = document.createElement('button');
    b.className = 'answer-btn';
    b.innerHTML = `<div style="width:26px;font-weight:800">${String.fromCharCode(65+idx)}</div><div style="flex:1;text-align:left">${escapeHtml(c)}</div>`;
    // if previously attempted (localStorage), disable
    const hist = JSON.parse(localStorage.getItem(attemptsKey) || '[]');
    const prev = hist.find(a=>a.qid===q.id);
    if(prev){
      b.disabled = true; b.classList.add('disabled');
      if(idx===q.correct) b.classList.add('correct');
      if(prev.chosenIdx!==undefined && prev.chosenIdx===idx && !prev.correct) b.classList.add('wrong');
    } else {
      b.addEventListener('click', ()=>{
        // lock answers
        Array.from(answersEl.querySelectorAll('.answer-btn')).forEach((bb,i)=>{ bb.disabled=true; bb.classList.add('disabled'); if(i===q.correct) bb.classList.add('correct'); });
        // show chosen
        if(idx!==q.correct) b.classList.add('wrong');
        // record
        recordAttempt(q.id, idx, idx===q.correct);
        btnNext.disabled=false;
      });
    }
    answersEl.appendChild(b);
  });
}

btnNext.addEventListener('click', ()=>{
  quizIndex++;
  if(quizIndex < quizList.length) loadQuizQuestion(); else showSummary();
});
btnPrev.addEventListener('click', ()=>{
  if(quizIndex>0){ quizIndex--; loadQuizQuestion(); }
});
btnSkip.addEventListener('click', ()=>{
  // mark skipped attempt
  const q = quizList[quizIndex];
  recordAttempt(q.id, null, false, true);
  quizIndex++;
  if(quizIndex < quizList.length) loadQuizQuestion(); else showSummary();
});

function showSummary(){
  progressInfo.textContent = `Fim — ${quizList.length} perguntas`;
  qText.textContent = `Resumo do Quiz`;
  answersEl.innerHTML = '';
  summaryArea.style.display='block';
  const hist = JSON.parse(localStorage.getItem(attemptsKey) || '[]');
  const inThis = hist.filter(a=> quizList.some(q=>q.id===a.qid));
  const correct = inThis.filter(a=>a.correct).length;
  const wrong = inThis.filter(a=>a.correct===false && !a.skipped).length;
  const skipped = inThis.filter(a=>a.skipped).length;
  summaryArea.innerHTML = `<div><strong>Acertos:</strong> ${correct}</div>
    <div><strong>Erros:</strong> ${wrong}</div>
    <div><strong>Pulos:</strong> ${skipped}</div>
    <div style="margin-top:8px"><strong>Porcentagem:</strong> ${Math.round((correct / quizList.length) * 100)}%</div>`;
}

/* ========== attempts (local) ========= */
function recordAttempt(qid, chosenIdx=null, isCorrect=false, skipped=false){
  try{
    const arr = JSON.parse(localStorage.getItem(attemptsKey) || '[]');
    arr.push({ qid, chosenIdx, correct: !!isCorrect, skipped: !!skipped, at: new Date().toISOString() });
    localStorage.setItem(attemptsKey, JSON.stringify(arr));
  }catch(e){ console.warn(e); }
}

/* ========== preview modal ========= */
function showPreview(q){
  const modal = document.createElement('div'); modal.className='modal';
  const box = document.createElement('div'); box.className='modal-box';
  box.innerHTML = `<h3 style="margin:0 0 8px 0;color:var(--accent-2)">${escapeHtml(q.subject)} — ${escapeHtml(q.content)} <small class="small">(${escapeHtml(q.exam)})</small></h3>
    <p style="font-weight:700">${escapeHtml(q.q)}</p>
    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
      ${q.choices.map((c,i)=>`<div style="padding:8px;border-radius:8px;background:#0a0a16;border:1px solid rgba(255,255,255,0.04)">${String.fromCharCode(65+i)}. ${escapeHtml(c)}</div>`).join('')}
    </div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
      <button class="btn ghost" id="closeModalBtn">Fechar</button>
    </div>`;
  modal.appendChild(box);
  modalRoot.appendChild(modal);
  document.getElementById('closeModalBtn').addEventListener('click', ()=> modal.remove());
}

/* ========== export/import ========= */
btnExport.addEventListener('click', ()=>{
  const data = JSON.stringify(QUESTIONS, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='questoes_studyflix_export.json'; a.click(); URL.revokeObjectURL(url);
});

btnImport.addEventListener('click', ()=>{
  const paste = prompt('Cole aqui o JSON de questões (formato array). Atenção: import irá anexar as questões atuais.');
  if(!paste) return;
  try{
    const arr = JSON.parse(paste);
    if(!Array.isArray(arr)){ alert('JSON inválido — deve ser um array'); return; }
    // basic validation and append
    let added=0;
    arr.forEach(item=>{
      if(item.q && item.choices && Array.isArray(item.choices) && item.subject && item.content){
        // assign id
        const newId = QUESTIONS.length ? QUESTIONS[QUESTIONS.length-1].id + 1 : 1001;
        QUESTIONS.push({...item, id:newId, area: item.area || currentArea || 'Geral'});
        added++;
      }
    });
    alert(`Import concluído. ${added} questões anexadas.`);
    applyFilters();
  }catch(e){ alert('Erro ao ler JSON: ' + e.message); }
});

/* search & controls */
searchInput.addEventListener('input', debounce(()=>applyFilters(), 300));
filterSubject.addEventListener('change', ()=>applyFilters());
filterContent.addEventListener('change', ()=>applyFilters());
filterExam.addEventListener('change', ()=>applyFilters());
btnClearSearch.addEventListener('click', ()=>{ searchInput.value=''; applyFilters(); });

/* ========== utils ========== */
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
function escapeHtml(s){ return String(s).replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]||c)); }
function debounce(fn,wait){ let t; return function(){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,arguments),wait); } }

/* ========== initial state (show nothing until area clicked) ========== */
(function init(){
  // nothing — user must pick area
})();
</script>
</body>
</html>
