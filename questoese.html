<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Studyflix - Questões</title>
    <style>
        /* Estilos do design de page.html adaptados */
        body {
            margin: 0;
            background-color: #000000;
            color: #fff;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
            padding-top: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Cabeçalho estilo Netflix */
        header {
            background-color: #141414;
            height: 70px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
        }

        .header-content {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header img.logo {
            height: 45px;
            cursor: pointer;
            user-select: none;
        }

        header nav {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            color: #fff;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            user-select: none;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 8px 0;
            border-bottom: 3px solid transparent;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #9b59b6;
            border-bottom: 3px solid #9b59b6;
        }

        /* Área de Questões */
        .main-content {
            display: flex;
            width: 100%;
            max-width: 1200px;
            gap: 30px;
        }

        .questions-area {
            flex: 2;
            background-color: #141414;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.8);
        }

        .questions-area h2 {
            font-size: 2.2rem;
            border-bottom: 4px solid #9b59b6;
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-shadow: 0 0 8px rgba(155, 89, 182, 0.8);
        }

        /* Estilo da Questão */
        .question-card {
            background-color: #1c1c1c;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid #333;
        }

        .question-card p.enunciado {
            font-size: 1.15rem;
            line-height: 1.6;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .options-list {
            list-style: none;
            padding: 0;
        }

        .options-list li {
            margin-bottom: 8px;
        }

        .options-list button {
            width: 100%;
            text-align: left;
            padding: 12px 15px;
            background-color: #2a2a2a;
            color: #fff;
            border: 2px solid #3c3c3c;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .options-list button:hover {
            background-color: #333;
            border-color: #9b59b6;
        }

        /* Estilos de Feedback */
        .options-list button.correct {
            background-color: #27ae60;
            /* Verde */
            border-color: #1e8449;
            pointer-events: none;
        }

        .options-list button.incorrect {
            background-color: #e74c3c;
            /* Vermelho */
            border-color: #c0392b;
            pointer-events: none;
        }

        .options-list button.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        .subject-bar {
            display: flex;
            justify-content: flex-start;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            padding: 0 40px;
            width: 100%;
            max-width: 1200px;
        }

        .subject-bar button {
            background-color: #1c1c1c;
            color: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1rem;
            text-transform: uppercase;
        }

        .subject-bar button:hover {
            background-color: #333;
        }

        .subject-bar button.active {
            background-color: #9b59b6;
            color: white;
            cursor: default;
        }

        /* Sidebar - Ranking */
        .ranking-area {
            flex: 1;
            min-width: 300px;
            background-color: #141414;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .ranking-area h2 {
            font-size: 1.8rem;
            border-bottom: 3px solid #9b59b6;
            padding-bottom: 8px;
            margin-bottom: 20px;
            text-shadow: 0 0 5px rgba(155, 89, 182, 0.5);
        }

        .ranking-list {
            list-style: none;
            padding: 0;
        }

        .ranking-list li {
            background-color: #1c1c1c;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.05rem;
        }

        .ranking-list li .score {
            font-weight: 700;
            color: #9b59b6;
        }

        .ranking-list li.top-score {
            border: 2px solid gold;
            background-color: #222;
        }

        /* Responsividade */
        @media (max-width: 1000px) {
            .main-content {
                flex-direction: column;
            }

            .questions-area,
            .ranking-area {
                width: 100%;
                max-width: 100%;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="header-content">
            <img src="https://i.ibb.co/Z1BfkM6Y/Logo-1.png" alt="Logo Studyflix" class="logo" id="logo" />
            <nav>
                <h3 id="btn-videos" class="nav-link">VÍDEOS</h3>
                <h3 id="btn-questoes" class="nav-link active">QUESTÕES</h3>
            </nav>
        </div>
    </header>

    <nav class="subject-bar" aria-label="Seleção de Área" id="area-bar">
        </nav>

    <div class="main-content">
        <section class="questions-area">
            <h2 id="area-title">Questões</h2>
            <div id="questions-container">
                </div>
        </section>

        <aside class="ranking-area">
            <h2>Ranking</h2>
            <p id="user-name-display">Usuário: Carregando...</p>
            <ul class="ranking-list" id="ranking-list">
                </ul>
        </aside>
    </div>

    <script>
        // ESTA É A ESTRUTURA VAZIA QUE SEU PHP DEVE PREENCHER AO CARREGAR A PÁGINA.
        // A lógica do JavaScript usará as chaves "Natureza" e "Humanas".
        const questionsData = {
            "Natureza": [], // SEU PHP DEVE INJETAR AS QUESTÕES AQUI
            "Humanas": []  // SEU PHP DEVE INJETAR AS QUESTÕES AQUI
        };

        // EXPLICITANDO AS ÁREAS QUE DEVEM SER VISÍVEIS NO BAR
        // Se a sua área de Humanas estava vazia, este array garante o botão.
        const availableAreas = ["Natureza", "Humanas"];

        // Variáveis de Estado
        let currentArea = 'Natureza'; // Inicia com Ciências da Natureza
        let questionsAnswered = {}; // { q_id: true/false }
        let score = 0;

        // Elementos DOM
        const logo = document.getElementById('logo');
        const btnVideos = document.getElementById('btn-videos');
        const areaBar = document.getElementById('area-bar');
        const questionsContainer = document.getElementById('questions-container');
        const areaTitle = document.getElementById('area-title');
        const rankingList = document.getElementById('ranking-list');
        const userNameDisplay = document.getElementById('user-name-display');

        // -------------------------------------------------------------------
        // Lógica de Usuário e Ranking (CORRIGIDO: Confirmação de Usuário)
        // -------------------------------------------------------------------

        /**
         * Solicita e armazena o nome do usuário no localStorage para o ranking.
         */
        function getUserName() {
            let userName = localStorage.getItem('studyflixUserName');
            if (!userName) {
                // Solicita o nome na primeira vez que acessa.
                userName = prompt("Bem-vindo(a) à seção de Questões! Por favor, digite seu nome para o Ranking:", "Seu Nome");
                if (userName && userName.trim()) {
                    localStorage.setItem('studyflixUserName', userName.trim());
                    userName = userName.trim();
                } else {
                    userName = "Aluno Anônimo";
                    localStorage.setItem('studyflixUserName', userName);
                }
            }
            return userName;
        }

        /**
         * Adiciona o resultado do quiz ao ranking no localStorage.
         */
        function logScore(score, area) {
            const userName = getUserName();
            const ranking = JSON.parse(localStorage.getItem('studyflixRanking') || '[]');
            // ATENÇÃO: Se questionsData[area] estiver vazio, length será 0.
            const maxScore = questionsData[area].length > 0 ? questionsData[area].length : 1; 
            const percentage = ((score / maxScore) * 100).toFixed(0);

            const newEntry = {
                name: userName,
                score: score,
                max: questionsData[area].length,
                percentage: percentage,
                area: area,
                timestamp: Date.now()
            };

            // Adiciona a nova entrada e limita o ranking a 10 entradas
            ranking.push(newEntry);
            ranking.sort((a, b) => b.score - a.score || b.percentage - a.percentage || b.timestamp - a.timestamp); 
            localStorage.setItem('studyflixRanking', JSON.stringify(ranking.slice(0, 10)));
            
            // Força a atualização da lista do ranking
            renderRanking();
        }

        /**
         * Renderiza a lista do ranking na sidebar.
         */
        function renderRanking() {
            const ranking = JSON.parse(localStorage.getItem('studyflixRanking') || '[]');
            rankingList.innerHTML = '';

            const userName = getUserName();
            userNameDisplay.textContent = `Usuário: ${userName}`;

            if (ranking.length === 0) {
                rankingList.innerHTML = '<li>Nenhuma pontuação registrada ainda.</li>';
                return;
            }

            ranking.forEach((entry, index) => {
                const li = document.createElement('li');
                const isUserEntry = entry.name === userName;
                
                li.className = isUserEntry ? 'top-score' : '';

                li.innerHTML = `
                    <span>${index + 1}. ${entry.name} (${entry.area})</span>
                    <span class="score">${entry.score}/${entry.max} (${entry.percentage}%)</span>
                `;
                rankingList.appendChild(li);
            });
        }

        // -------------------------------------------------------------------
        // Lógica da Área de Questões (CORRIGIDO: Inclusão de ambas as áreas no bar)
        // -------------------------------------------------------------------

        /**
         * Alterna a área ativa (Natureza/Humanas).
         */
        function changeArea(areaName) {
            currentArea = areaName;
            questionsAnswered = {};
            score = 0;
            areaTitle.textContent = `Questões de ${areaName}`;
            renderAreaBar();
            renderQuestions();
        }

        /**
         * Renderiza a barra de seleção de áreas.
         */
        function renderAreaBar() {
            areaBar.innerHTML = '';
            // Usa o array explícito para garantir que o botão Humanas apareça
            availableAreas.forEach(area => { 
                const button = document.createElement('button');
                button.textContent = area.toUpperCase();
                if (area === currentArea) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => changeArea(area));
                areaBar.appendChild(button);
            });
        }

        /**
         * Renderiza as questões da área atual.
         */
        function renderQuestions() {
            questionsContainer.innerHTML = '';
            const questions = questionsData[currentArea];

            // Verifica se há questões carregadas pelo PHP
            if (!questions || questions.length === 0) {
                 questionsContainer.innerHTML = `<p style="font-size: 1.5rem; color: #e74c3c;">Nenhuma questão encontrada para a área: ${currentArea}. Por favor, verifique se seu banco de dados está populado corretamente.</p>`;
                 return;
            }


            questions.forEach(q => {
                const card = document.createElement('div');
                card.className = 'question-card';
                card.id = `q-${q.id}`;
                card.innerHTML = `
                    <p class="enunciado"><strong>Questão ${q.id} (${q.subject})</strong>: ${q.question}</p>
                    <ul class="options-list" data-question-id="${q.id}">
                        ${Object.keys(q.options).map(key => `
                            <li>
                                <button data-option-key="${key}" data-correct="${key === q.correctOption ? 'true' : 'false'}">
                                    <strong>${key})</strong> ${q.options[key]}
                                </button>
                            </li>
                        `).join('')}
                    </ul>
                `;
                questionsContainer.appendChild(card);
            });

            // Adiciona evento de clique a todos os botões de opção
            questionsContainer.querySelectorAll('.options-list button').forEach(button => {
                button.addEventListener('click', handleAnswer);
            });
        }

        /**
         * Lida com a resposta do usuário a uma questão.
         */
        function handleAnswer(event) {
            const button = event.currentTarget;
            const list = button.closest('.options-list');
            const questionId = list.dataset.questionId;
            const isCorrect = button.dataset.correct === 'true';

            if (questionsAnswered[questionId]) return;

            // 1. Marca a questão como respondida
            questionsAnswered[questionId] = true;

            // 2. Desativa todos os botões da questão e aplica o feedback visual
            list.querySelectorAll('button').forEach(btn => {
                btn.classList.add('disabled');
                if (btn.dataset.correct === 'true') {
                    btn.classList.add('correct');
                }
            });

            // 3. Aplica o feedback visual na opção selecionada
            if (isCorrect) {
                score++;
            } else {
                button.classList.add('incorrect');
            }

            // 4. Verifica se todas as questões foram respondidas
            if (questionsData[currentArea].length > 0 && Object.keys(questionsAnswered).length === questionsData[currentArea].length) {
                setTimeout(() => {
                    alert(`Quiz Concluído! Você acertou ${score} de ${questionsData[currentArea].length} questões.`);
                    logScore(score, currentArea);
                    // Recarregar o quiz para recomeçar, mantendo o usuário na mesma área
                    changeArea(currentArea);
                }, 500);
            }
        }

        // -------------------------------------------------------------------
        // Inicialização
        // -------------------------------------------------------------------

        function init() {
            // 1. Inicializa o nome do usuário e o ranking
            getUserName();
            renderRanking();

            // 2. Configurações iniciais: carrega a área Natureza
            changeArea(currentArea);

            // 3. Redirecionamentos do Header (assumindo a estrutura de navegação)
            logo.addEventListener('click', () => {
                window.location.href = 'page.html'; 
            });

            btnVideos.addEventListener('click', () => {
                window.location.href = 'videos.html';
            });
        }

        // Inicia a aplicação
        init();
    </script>
</body>

</html>